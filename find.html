<!doctype html>
<html lang="zh, en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Index Page">
<meta name="author" content="罗寅松, 张锐">
<link rel="icon" href="./assets/images/STOS.png">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>查看查早信息</title>

<!-- 新 Bootstrap4 核心 CSS 文件 -->
<link rel="stylesheet" href="bootstrap-4.0.0/css/bootstrap.min.css">

<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>

<!-- popper.min.js 用于弹窗、提示、下拉菜单 -->
<script src="https://cdn.staticfile.org/popper.js/1.12.5/umd/popper.min.js"></script>

<!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
<script src="bootstrap-4.0.0/js/bootstrap.min.js"></script>

<!-- Custom styles for this template -->
<link href="bootstrap-4.0.0/css/extra/jumbotron.css" rel="stylesheet">
</head>

<body class="fix-header fix-sidebar card-no-border">
	<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
		<a class="navbar-brand" href="/index.html">学风督导队</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarsExampleDefault">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item active">
					<a class="nav-link" href="/find.html">数据查看<span class="sr-only">(current)</span></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#" onClick="aler(1)">往期活动</a>
				</li>
				<li class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">5月学风宣传月活动</a>
					<div class="dropdown-menu" aria-labelledby="dropdown01">
						<a class="dropdown-item" href="#">主题演讲比赛</a>
						<a class="dropdown-item" href="/event/zaoqi.html">早起21天</a>
						<a class="dropdown-item" href="/event/shudan.html">旧书换新书</a>
					</div>
				</li>
				<!--<li class="nav-item"> <a class="nav-link disabled" href="#">Disabled</a> </li> -->
				<li class="nav-item dropdown">
					<a href="#" class="nav-link dropdown-toggle" id="dropdown02" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">队伍介绍</a>
					<div class="dropdown-menu" aria-labelledby="dropdown02">
						<a class="dropdown-item" href="#" onClick="aler(1)">队长、副队</a>
						<a class="dropdown-item" href="#" onClick="aler(1)">数据组</a>
						<a class="dropdown-item" href="#" onClick="aler(1)">现场组</a>
						<a class="dropdown-item" href="#" onClick="aler(1)">新闻组</a>
						<a class="dropdown-item" href="#" onClick="aler(1)">早餐组</a>
					</div>
				</li>
			</ul>
			<!--<form class="form-inline my-2 my-lg-0">
				<input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
				<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
			</form>-->
			<ul class="navbar-nav mr-right">
				<li class="nav-item">
					<a class="nav-link" href="/log/login.php"><span data-feather="log-in"></span> 登陆</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/log/register.php"><span data-feather="pen-tool"></span> 注册</a>
				</li>
			</ul>
		</div>
	</nav>
    <main role="main"> 
        <br>
  		<!-- Main jumbotron for a primary marketing message or call to action -->
        <div class="container">
            <div class="card">
                <div class="card-body">
                    <h3>查早信息查看说明</h3>
                    <ul class="list-group">
						<li class="list-group-item list-group-item-danger">周汇总时，请假学生计入总应到人数，故和每日汇总结果有一定偏差，望知晓<br/>本页展示的每日数据均为原始数据，每周末会对存在问题的数据（如：数据缺失）进行处理。处理后的数据会和每日数据有一定不同</li>
                        <li class="list-group-item list-group-item-info">当天的数据请在9:00后查看，确保督导队组员录入完毕</li>
                        <li class="list-group-item list-group-item-info">当日出勤率：<br/>出勤率=(出勤1+出勤2)/2/(应到人数-请假人数)<br/>出勤1为7:35统计的人数<br/>出勤2为8:05统计的人数</li>
                        <li class="list-group-item list-group-item-info">若数据存在问题请尽快与督导队联系</li>
                    </ul>
                </div>
            </div>
        </div>
        <br>
		<div class="container">
            <!-- Example row of columns -->
            <!-- <div class="card">
                <div class="card-body"> -->
                    <div class="row">
                        <div class="col-lg-6 col-md-6">
                            <form action="" id="xyf">
                                <div class="form-group">
                                    <label for="date">日期</label>
                                    <input type="date" name="user_date" id="date" class="form-control"/>
                                </div>
                                <div class="form-group">
                                    <label for="xueyuan">学院</label>
                                    <select name="customers" id="xy" class="form-control" >
                                        <option value="">请选择学院</option>
                                        <option value="信通" id="xt">信通</option>
                                        <option value="电子" id="dz">电子</option>
                                        <option value="空天" id="kt">空天</option>
                                        <option value="机电" >机电</option>
                                        <option value="光电">光电</option>
                                        <option value="自动化">自动化</option>
                                        <option value="数学">数学</option>
                                        <option value="资环">资环</option>
                                        <option value="计算机">计算机</option>
                                        <option value="物理">物理</option>
                                        <option value="材料">材料</option>
                                        <option value="信软">信软</option>
                                        <option value="格院">格院</option>
                                        <option value="外国语">外国语</option>
                                        <option value="生命">生命</option>
                                        <option value="英才">英才</option>
                                        <option value="医学院">医学院</option>
                                        <option value="经管">经管</option>
                                        <option value="公管">公管</option>
                                    </select>
                                </div>
                            
                                <button type="button" onclick="find()" class="btn btn-primary"  >查看</button>
                            </form>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div id="txtHint" class="col-lg-12 col-md-12">
                            <div class="alert alert-info alert-dismissible">
                                <button type="button" class="close" data-dismiss="alert">&times;</button>
                                <strong>注意</strong> 结果将在这里显示。
                            </div>
                        </div>
                    </div>
                <!-- </div>
            </div> -->
        </div>

		<!-- /container -->
    </main>
    <br>
	<footer class="container">
		<p>2019 电子科技大学 学工部 学风督导队</p>
	</footer>
    <script>
        function find(){
            var date = document.getElementById('date').value;
            var xueyuan = document.getElementById('xy').value;
            var xmlhttp;
            var rejson;
            var fenzi=0;
            var fenmu=0;
            var chuqin=0;
            var innerstring="<div class='table-responsive'><table class='table table-striped'>";
            if (xueyuan=="" || date=="")
            {
                document.getElementById("txtHint").innerHTML='<div class="alert alert-danger alert-dismissible"><button type="button" class="close" data-dismiss="alert">&times;</button>'+"<strong>请检查日期和学院</strong></div>";
                return;
            }
            if (window.XMLHttpRequest)
            {
                // IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
                xmlhttp=new XMLHttpRequest();
            }
            else
            {
                // IE6, IE5 浏览器执行代码
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange=function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    rejson=JSON.parse(xmlhttp.responseText);
                    //innerstring=innerstring+"<h4>"+date+" "+xueyuan+"学院"+"</h4>";            
                    innerstring=innerstring+"<thead><tr><th>教室</th><th>应到</th><th>请假</th><th>迟到</th><th>出勤1</th><th>违纪</th><th>出勤2</th><th>早退</th><th>备注</th></tr></thead>";
                    innerstring=innerstring+"<tbody>";
                    if (rejson.length==0){
                        document.getElementById("txtHint").innerHTML='<div class="alert alert-danger alert-dismissible"><button type="button" class="close" data-dismiss="alert">&times;</button>'+"<strong>未查找到信息，请检查日期或稍后再尝试</strong></div>";
                    }
                    else{
                        for(var i=0;i<rejson.length;i++){
                            innerstring+="<tr>"
                            innerstring=innerstring+"<td>"+rejson[i].区号+rejson[i].教室编号+"</td>";
                            innerstring=innerstring+"<td>"+rejson[i].应到人数+"</td>";
                            innerstring=innerstring+"<td>"+rejson[i].请假人数+"</td>";
                            innerstring=innerstring+"<td>"+rejson[i].迟到人数+"</td>";
                            innerstring=innerstring+"<td>"+rejson[i].第一次出勤+"</td>";
                            innerstring=innerstring+"<td>"+rejson[i].违纪人数+"</td>";
                            innerstring=innerstring+"<td>"+rejson[i].第二次出勤+"</td>";
                            innerstring=innerstring+"<td>"+rejson[i].早退人数+"</td>";
                            innerstring=innerstring+"<td>"+rejson[i].备注+"</td>";
                            innerstring+="</tr>";
                            fenzi = fenzi+(parseInt(rejson[i].第一次出勤)/2+parseInt(rejson[i].第二次出勤)/2);
                            fenmu = fenmu+(parseInt(rejson[i].应到人数-rejson[i].请假人数));
                        }
                        innerstring+="</tbody></table></div>";
                        chuqin = (fenzi/fenmu)*100;
                        // innerstring=innerstring+"<h5>出勤率: "+chuqin.toString().slice(0,6)+"%"+"</h5>";
                        innerstring= '<div class="alert alert-success">'+"<strong>出勤率: "+chuqin.toString().slice(0,6)+"%"+"</strong></div>"+innerstring;
                        innerstring="<h4>"+date+" "+xueyuan+"学院"+"</h4>"+innerstring;  
                        document.getElementById("txtHint").innerHTML=innerstring;
                    }
                }
            }
            xmlhttp.open("GET","http://132.232.231.109/ajax/find.php?xy="+xueyuan+"&date="+date,true);
            xmlhttp.send();
        }
    </script>
    <script type="text/javascript">
        var mydateInput = document.getElementById("date");
        var date = new Date();
        var month;
        var day;
        if ((date.getMonth() + 1)<10){
            month = '0'+(date.getMonth() + 1).toString();
        }
        else{
            month = (date.getMonth() + 1).toString()
        }
        if(date.getDate()<10){
            day = '0'+date.getDate().toString();
        }
        else{
            day = date.getDate().toString();
        }
        var dateString = date.getFullYear() + "-" + month + "-" + day;
        mydateInput.value = dateString;
    </script>
    <!-- Bootstrap core JavaScript
		================================================== --> 
    <!-- Placed at the end of the document so the pages load faster --> 

    <!-- Icons --> 
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script> 
    <script>
		feather.replace()
	</script> 
    <script>
		window.jQuery || document.write('<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"><\/script>')
	</script>
</body>
</html>
